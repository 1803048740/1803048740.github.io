---
title: 序列
top_img: 
categories: 
- ETL工程师
- SQL基础
tags:
- 序列
---

# 序列




要学怎么创建序列，需要注意什么，提问：怎么应用序列

含义：序列是ORACLE提供的一组能够自动递增或递减的序号，常用来生成主键自增

语法:
`CREATE SEQUENCE`  序列名      		   --创建序列名   
`START` `WITH` N1                          --初始值N1
`INCREMENT` BY N2                    	--增长幅度N2
`MINVALUE` N3                            --最小值N3          `NOMINVALUE`
`MAXVALUE` N4                            --最大值N4          `NOMAXVALUE`
`CACHE` N5                               --缓存N5              `NOCACHE`
`CYCLE`;                                 --循环                  `NOCYCLE`

```sql
create sequence seq_class37 start with  increment by 1 maxvalue 10 cache 20 cycle; 

CREATE SEQUENCE SEQ_CLASS37
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 42
CACHE 20
CYCLE;

```
`NEXTVAL` --下一个值
`CURRVAL` --当前值

```sql
SELECT SEQ_CLASS37.NEXTVAL FROM DUAL;
SELECT SEQ_CLASS37.CURRVAL FROM DUAL;
```

`CREATE` `SEQUENCE`  序列名     建议取名方式：==SEQ_名字==
`START` `WITH` N1                         	--1.初始值为多少，第一次运行出来的数字就为多少
                                           --2.初始值不能大于最大值，不能小于最小值
                                           --3.初始值只有在第一运行的有效
`INCREMENT BY` N2                            --当增长幅度为正数时，序列为递增序列；当增长幅度为负数时，序列为递减序列
                                           --增长幅度要小于最大值与最小值的差
`MINVALUE` N3                                --最小值的上限为负的==10^27^==
`MAXVALUE` N4                                --最大值的上限为正的==10^27^==
`CACHE` N5                                   --缓存可以理解为电脑先运行序列得到部分值，找值的时候就会被直接输出
                                           --必须大于==1==
                                           -- 能写的最大值=（最大值减去最小值）/增长幅度的绝对值  即==<=循环次数==
`CYCLE`;                                     --如果有循环，当得到的值==超过最大值或最小值，会得到最小值或最大值==

`NEXTVAL` --第一次运行找到的是初始值，但是第一次运行必须是NEXTVAL
`CURRVAL` --如果一次NEXTVAL都没有运行过，CURRVAL是不能运行的

**删除序列的方法：**==DROP SEQUENCE 序列名==;

`CREATE SEQUENCE`  序列名                     -- ==可以只有第一行==，其他的所有东西都是默认值
`START WITH`                                 --当不写初始值时，默认从==最小值==开始，最小值和初始值都不写时，默认从==1==开始
`INCREMENT BY`                      		 --当不写增长幅度时，默认增长幅度为==1==
`MINVALUE`                             	  --最小值的上限为负的==10^27^==
`MAXVALUE`                            	   --最大值的上限为正的==10^27^==
`CACHE`                                      --当不写缓存时，默认为==20==,写循环时不能超过循环的次数==<=循环次数==
`CYCLE`;                                     --当不写循环时，默认不循环；当不循环时，当下一个值超过最大/最小值时，会报错

**修改序列：**
==ALTER SEQUENCE 序列名==
==需要修改的部分;==

**特点：**

- 修改序列不会使序列初始化，而会修改之后的值
- 不能修改初始值，哪怕什么都没运行；

**删除序列：**
`DROP` `SEQUENCE` 序列名;

```sql
DROP SEQUENCE SEQ_CLASS37;
```

提问：1.当序列为递增序列时，需要设置最大值；当序列为递减序列时，需要设置最小值。对不对？
2.怎么应用序列？
3.能在序列里面插入函数吗？

```sql
SELECT A.* ,SEQ_CLASS37.NEXTVAL FROM EMP A;

SELECT SEQ_CLASS37.CURRVAL FROM DUAL;

INSERT INTO EMP(EMPNO) VALUES(SEQ_CLASS37.nextVAL);
SELECT * FROM EMP;
```





> 序列(`SEQUENCE`)是序列号生成器，可以为表中的行自动生成序列号，产生一组等间隔的数值(类型为数字)。不占用磁盘空间，占用内存。
>
> 其主要用途是生成表的主键值，可以在插入语句中引用，也可以通过查询检查当前值，或使序列增至下一个值。



创建序列需要==CREATE SEQUENCE==系统权限。序列的创建语法如下：

　　`CREATE` `SEQUENCE` 序列名

　　[`INCREMENT` `BY` n1]

　　[`START` `WITH` n2]

　　[{`MAXVALUE`/ `MINVALUE` n3| `NOMAXVALUE`}]

　　[{`CYCLE`|`NOCYCLE`}]

　　[{`CACHE` n4| `NOCACHE`}];

  其中：

- `INCREMENT BY`用于定义序列的步长，如果省略，则默认为1，如果出现负值，则代表Oracle序列的值是按照此步长递减的。

- `START WITH` 定义序列的初始值(即产生的第一个值)，默认为1。==如果不写按照最小值来==

- `MAXVALUE` 定义序列生成器能产生的最大值。选项`NOMAXVALUE`是默认选项，代表没有最大值定义，这时对于递增Oracle序列，系统能够产生的最大值是10的27次方;对于递减序列，最大值是-1。

- `MINVALUE`定义序列生成器能产生的最小值。选项`NOMAXVALUE`是默认选项，代表没有最小值定义，这时对于递减序列，系统能够产生的最小值是?10的26次方;对于递增序列，最小值是1。

- `CYCLE`和`NOCYCLE` 表示当序列生成器的值达到限制值后是否循环。`CYCLE`代表循环，`NOCYCLE`代表不循环。如果循环，则当递增序列达到最大值时，循环到最小值;对于递减序列达到最小值时，循环到最大值。如果不循环，达到限制值后，继续产生新值就会发生错误。

- `CACHE`(缓冲)定义存放序列的内存块的大小，默认为20。`NOCACHE`表示不对序列进行内存缓冲。对序列进行内存缓冲，可以改善序列的性能。

  > ​	大量语句发生请求，申请序列时，为了避免序列在运用层实现序列而引起的性能瓶颈。Oracle序列允许将序列提前生成 cache x个先存入内存，在发生大量申请序列语句时，可直接到运行最快的内存中去得到序列。但cache个数也不能设置太大，因为在数据库重启时，会清空内存信息，预存在内存中的序列会丢失，当数据库再次启动后，序列从上次内存中最大的序列号+1 开始存入cache x个。这种情况也能会在数据库关闭时也会导致序号不连续。

- `NEXTVAL` 返回序列中下一个有效的值，任何用户都可以引用。

- `CURRVAL` 中存放序列的当前值,`NEXTVAL` 应在 `CURRVAL` 之前指定 ，二者应同时有效。